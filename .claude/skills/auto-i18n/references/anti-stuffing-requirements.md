# 反堆砌要求 (Anti-Stuffing Requirements)

> **这是强制性要求，不得绕过。所有生成的内容必须通过反堆砌检测，否则自动重写。**

---

## 核心原则

### 自然度 > SEO密度

```markdown
优先级排序：
1. 内容自然流畅（最高优先级）
2. 可读性良好
3. SEO 关键词优化（最低优先级）

如果密度和自然度冲突 → 优先保证自然度
```

---

## 关键词密度计算（重要修改）

### ⛔ Alt 文本不计入关键词密度

```markdown
## 旧算法（错误）
关键词密度 = (Title + H1 + H2 + Body + Alt 中的关键词数) / (Body + Alt 总字数)

## 新算法（正确）
关键词密度 = (Title + H1 + H2 + Body 中的关键词数) / (Body 总字数)

## 重要：Alt 独立评估
- Alt 的作用是描述图片，不是 SEO 工具
- Alt 中可以自然融入关键词，但非必须
- Alt 中关键词最多1次，禁止堆砌
```

### 新的关键词密度目标

| 语言 | 目标密度 | 健康范围 | 警告范围 | 失败条件 |
|------|---------|---------|----------|----------|
| ZH | 2.0-3.0% | 1.8-3.5% | 3.5-4.0% | >4.0% 或 <1.5% |
| EN | 1.8-2.5% | 1.5-3.0% | 3.0-3.5% | >3.5% 或 <1.2% |
| JA/KO | 2.0-2.8% | 1.8-3.2% | 3.2-3.8% | >3.8% 或 <1.5% |

**说明：**
- 目标密度：最佳范围
- 健康范围：可接受范围
- 警告范围：需要优化但可通过
- 失败条件：必须重写

---

## 关键词分布策略（新）

### 使用扩展关键词数据

```markdown
## 从 keywords-{locale}.json 读取

{
  "primary": "AI绘画",              // 主关键词
  "alternatives": [...],            // 高搜索量替代词
  "semanticVariants": [...],        // 语义变体（新增）
  "relatedTerms": [...],            // 相关术语（新增）
  "longTail": [...],                // 长尾词（新增）
  "usageGuidelines": {...},         // 使用指南（新增）
  "antiPatterns": [...],            // 反面示例（新增）
  "goodExamples": [...]             // 正面示例（新增）
}
```

### 分布策略（多样化优先）

```markdown
## Title（1次，使用 primary）
✅ "AI绘画工具 - 免费在线生成 | MakeMyPic"
❌ "AI绘画 - AI绘画平台 | AI绘画工具"

## 🚨 H1（1次，**必须包含 primary** - 一票否决）

### H1 规则是最高优先级规则，违反 = 自动 FAIL

**为什么 H1 必须包含主词？**
1. H1 是页面第二重要的 SEO 元素（仅次于 Title）
2. 搜索引擎给 H1 的权重远高于其他标题
3. H1 缺少主词 = SEO 效果大幅下降（可能降低 50% 排名）
4. 用户扫描页面时，H1 是第一眼看到的内容

**正确示例：**
✅ "AI绘画 - 智能图像生成工具" ← 包含主词"AI绘画"
✅ "专业AI绘画平台" ← 包含主词"AI绘画"
✅ "使用AI绘画创作艺术作品" ← 包含主词"AI绘画"

**错误示例（一票否决）：**
❌ "智能绘画平台 - 在线创作工具" ← 只有语义变体，缺少主词
❌ "数字艺术生成工具" ← 只有语义变体，缺少主词
❌ "在线图像创作平台" ← 只有相关术语，缺少主词
❌ "AI绘画工具 - AI绘画平台" ← 堆砌主词（另一个极端）

**检测方法：**
```python
# 自动检测脚本会验证
h1_text = extract_h1(json_file)
if primary_keyword not in h1_text:
    return FAIL  # 一票否决，立即重写
```

## H2（2-4个含关键词，重要检查）

### 🚨 H2 检查规则（重要，会影响通过）

**要求：**
1. 至少 2-4 个 H2 包含关键词（主词或语义变体）
2. 主词比例 ≤ 50%（避免堆砌）
3. 优先使用语义变体和相关术语

**策略：** 混合使用 primary (30-40%)、semanticVariants (40-50%)、longTail (20-30%)

✅ 正确示例（通过检查）：
  H2-1: "AI绘画的核心功能" ← primary（1个主词）
  H2-2: "智能图像生成工具的使用方法" ← semanticVariant
  H2-3: "数字艺术创作的应用场景" ← relatedTerm
  H2-4: "免费AI绘画工具如何选择" ← longTail

  分析：4/4 个含关键词，主词占 25%（1/4）✅

❌ 错误示例（堆砌，检查失败）：
  H2-1: "AI绘画的功能"
  H2-2: "AI绘画的使用"
  H2-3: "AI绘画的优势"  ← 每个都用主词
  H2-4: "AI绘画的特点"

  分析：4/4 个都是主词，比例 100%（堆砌）❌

❌ 错误示例（关键词不足，检查失败）：
  H2-1: "功能介绍"
  H2-2: "使用方法"
  H2-3: "应用场景"  ← 无关键词
  H2-4: "产品特点"

  分析：0/4 个含关键词（SEO效果差）❌

## H3（0-6个，更多样化，建议性）

### ℹ️  H3 检查规则（建议性，仅警告）

**建议：**
1. H3 可以有 20-30% 包含关键词
2. 主词比例 ≤ 30%（建议）
3. 主要使用语义变体和相关术语
4. H3 检查失败不会阻止通过，仅警告

**策略：** primary (20-30%)、semanticVariants (50%)、longTail (20-30%)

✅ 建议示例：
  H3-1: "文生图功能介绍" ← relatedTerm
  H3-2: "图生图编辑工具" ← relatedTerm
  H3-3: "AI绘画的速度优势" ← primary（适度使用）
  H3-4: "免费积分使用规则" ← longTail

  分析：1/4 个主词，比例 25%（合理）✅

⚠️  警告示例（主词过多）：
  H3-1: "AI绘画功能详解"
  H3-2: "AI绘画使用技巧"
  H3-3: "AI绘画效果展示" ← 所有都是主词
  H3-4: "AI绘画常见问题"

  分析：4/4 个主词，比例 100%（过度优化）⚠️
  结果：警告但不阻止通过

## Body（分布策略）
目标：主词占30%，语义变体占40%，相关术语占30%

段落1: "AI绘画是一款..." ← primary
段落2: "这款智能绘画工具..." ← semanticVariant
段落3: "通过图像生成技术..." ← relatedTerm
段落4: "使用AI辅助创作..." ← semanticVariant
段落5: "我们的数字艺术平台..." ← relatedTerm
段落6: "专业的AI绘画服务..." ← primary

规则：
- 同段落主词最多1次
- 每次主词出现间隔≥50字（中文）/200字符（英文）
- 优先使用语义变体和相关术语

## Alt（独立评估，不计入密度）
✅ "展示AI绘画工具的用户界面截图"
✅ "智能图像生成的效果展示"
✅ "快速图标" ← 无关键词也OK
❌ "AI绘画工具AI绘画生成器"
❌ "AI绘画" ← 过于简短，缺乏描述性
```

---

## 强制检查点（Mandatory Checkpoints）

### Checkpoint 1: 生成后立即检测

```bash
## 执行反堆砌检测脚本
python scripts/check_keyword_quality.py \
  --file {generated_file} \
  --keyword {primary_keyword} \
  --locale {locale}

## 检测项目
✅ 关键词间距 ≥ 50字（中文）/200字符（英文）
✅ 段落重复 ≤ 1次/段
✅ 无非自然句式
✅ 可读性 ≥ 60
✅ Alt 质量通过（独立评估）
```

### Checkpoint 2: 不符合要求的处理

```markdown
## 如果检测失败

1. 自动诊断问题
   - 识别具体违规点
   - 分析失败原因

2. 自动调整生成参数
   - 降低关键词密度目标
   - 增加语义变体使用比例
   - 调整关键词分布策略

3. 重新生成内容
   - 使用调整后的参数
   - 应用正面示例引导
   - 避免反面模式

4. 再次检测
   - 重复步骤1-3
   - 最多重试3次

5. 如果3次都失败
   - 报错并停止
   - 输出详细失败报告
   - 提供修复建议
   - 不得绕过此检查
```

### Checkpoint 3: 质量评分

```markdown
## 评分必须通过所有门槛

Gate 0: 反堆砌检测（一票否决）
├─ ✅ 必须 PASS
└─ ❌ 不通过 → 重写（不得继续）

Gate 1: 内容质量
├─ E-E-A-T ≥ 18/27
├─ 词汇多样性 ≥ 70%
└─ 可读性 ≥ 60

Gate 2: SEO 优化
├─ 关键词相关度 ≥ 70%
├─ 密度在健康范围（不是目标范围也可接受）
└─ GEO 优化 ≥ 28/40

Gate 3: 技术规范
├─ JSON 结构正确
├─ Sitemap 已更新
└─ 内容排除规则遵守
```

---

## 正反示例（引导生成）

### 反面示例（绝对禁止）

```markdown
## 示例1：同段落堆砌
❌ "AI绘画是一款强大的AI绘画工具，使用AI绘画可以快速生成AI绘画作品。
     我们的AI绘画平台提供AI绘画服务，让AI绘画变得简单。"

问题：
- 同段落主词出现5次
- 间距过近（平均15字）
- 可读性极差

## 示例2：非自然句式
❌ "AI绘画的AI绘画功能非常强大"
❌ "使用AI绘画进行AI绘画创作"
❌ "免费的AI绘画工具AI绘画生成器"

问题：
- "X的X" 重复模式
- 为插入关键词而扭曲句子
- 连续堆砌

## 示例3：Alt 堆砌
❌ alt="AI绘画工具AI绘画生成器AI绘画平台"
❌ alt="AI绘画" ← 过于简短

问题：
- Alt 用于堆砌关键词
- 不描述图片内容
```

### 正面示例（参考标准）

```markdown
## 示例1：自然融入
✅ "AI绘画是一款智能图像生成工具，通过深度学习技术辅助创作，
     让艺术创作变得更加简单。我们的平台结合先进的人工智能算法，
     帮助用户快速实现创意构想。使用这款数字艺术工具，您可以轻松
     创作高质量的作品。"

优点：
- 主词仅1次
- 使用语义变体：智能图像生成、数字艺术工具
- 使用相关术语：人工智能算法、创意构想
- 可读性好，自然流畅

## 示例2：多样化表达
✅ 段落1: "AI绘画平台..."
✅ 段落2: "智能绘画工具..."
✅ 段落3: "图像生成服务..."
✅ 段落4: "AI艺术创作..."

优点：
- 每段用不同的表达
- 语义一致但词汇多样
- 避免重复

## 示例3：描述性 Alt
✅ alt="展示AI绘画工具的用户界面，包含提示词输入框和图片生成按钮"
✅ alt="智能绘画平台生成的风景画作品示例"
✅ alt="快速图标，表示生成速度快"

优点：
- 描述图片实际内容
- 自然融入关键词（或不融入）
- 符合可访问性要求
```

---

## ⚡ 生成前强制检查清单（Pre-Generation Checklist）

**在生成任何内容之前，你必须先完成以下承诺：**

```markdown
## 🚨 生成前承诺书

我即将为 {locale} 市场生成 SEO 优化内容。

在开始生成之前，我承诺将遵守以下规则：

### ✅ 标题层级承诺（强制，一票否决）

- [ ] H1：我将在 H1 中包含主关键词 "{primary_keyword}"
      示例："{primary_keyword} - 说明文字" 或 "修饰语 + {primary_keyword}"

- [ ] H2：我将生成 2-4 个 H2，其中至少 2 个包含关键词
      分布：主词 ≤ 50%，其余使用语义变体
      示例 H2-1: "{primary_keyword}的核心功能" ← 主词
      示例 H2-2: "{semanticVariant}的使用方法" ← 变体

- [ ] H3：如果生成 H3，主词比例 ≤ 30%
      主要使用语义变体和相关术语

### ✅ 关键词使用承诺

- [ ] 我将使用以下关键词池：
      - 主词：{primary_keyword}（使用频率：30%）
      - 语义变体：{semanticVariants}（使用频率：40%）
      - 相关术语：{relatedTerms}（使用频率：30%）

- [ ] 我将遵守分布规则：
      - 同段落主词最多 1 次
      - 关键词间距 ≥ 50 字（中文）/ 200 字符（英文）
      - 不使用 "X的X"、"X是X" 等堆砌模式

### ✅ 质量承诺

- [ ] 自然度 > SEO 密度（如果冲突，优先自然度）
- [ ] 内容为用户服务，不为搜索引擎服务
- [ ] 每段都包含实质信息，不为凑字数而写

我已阅读并理解上述规则，现在开始生成内容。

---
```

## 📝 分步生成流程（Step-by-Step Generation）

**不要一次性生成全部内容！按以下步骤生成：**

### Step 1: 生成标题大纲

```markdown
## 第一步：先生成标题结构

生成以下内容：
1. H1（1个）
2. H2（2-4个）
3. H3（可选，0-6个）

立即自我验证：
✅ H1 是否包含主关键词 "{primary_keyword}"？
✅ H2 中有 2-4 个包含关键词？
✅ H2 主词比例 ≤ 50%？
✅ H3 主词比例 ≤ 30%？

如果任一项为 ❌，立即修正标题，不要继续。
```

**标题示例（必须参考）：**

```markdown
✅ 正确的标题大纲：

H1: "AI绘画 - 智能图像生成工具" ← 包含主词 ✅

H2-1: "AI绘画的核心功能" ← 主词（1/4 = 25%）
H2-2: "智能图像生成的使用方法" ← 语义变体
H2-3: "数字艺术创作的应用场景" ← 相关术语
H2-4: "免费AI绘画工具的选择指南" ← 长尾词

验证：
- H1 包含主词？✅
- H2 含关键词数量：4/4 ✅
- H2 主词数量：1 个（25%）✅
- 通过，继续生成正文

---

❌ 错误的标题大纲（会被拒绝）：

H1: "智能图像生成工具" ← 缺少主词 ❌

验证：
- H1 包含主词？❌
- 立即停止，修正 H1

修正后：
H1: "AI绘画 - 智能图像生成工具" ← 包含主词 ✅
现在可以继续
```

### Step 2: 生成正文内容

```markdown
## 第二步：基于已验证的标题生成正文

现在标题已确认符合规则，开始生成正文。

正文生成规则：
1. 每段最多使用主词 1 次
2. 优先使用语义变体和相关术语
3. 主词间距 ≥ 50 字（中文）
4. 自然流畅 > SEO 密度
```

### Step 3: 生成后立即自验

```markdown
## 第三步：生成完成后立即自我检查

检查清单：

标题层级检查：
- [ ] H1 包含主关键词 "{primary_keyword}"？
- [ ] H2 有 2-4 个包含关键词？
- [ ] H2 主词比例 ≤ 50%？

内容质量检查：
- [ ] 同段落主词 ≤ 1 次？
- [ ] 关键词间距 ≥ 50 字？
- [ ] 无 "X的X" 等堆砌模式？

如果发现问题：
→ 立即定位问题位置
→ 只修改问题部分，不要重写全部
→ 修改后再次验证

通过所有检查 → 完成
```

---

## 🎯 强制性 Prompt 模板（用于实际生成）

```markdown
## 内容生成指令（强制使用）

你正在为{locale}市场生成SEO优化内容。

### 🚨 STEP 0: 生成前承诺（必须先完成）

在生成内容前，先回答以下问题：

1. 主关键词是什么？回答：{primary_keyword}
2. H1 必须包含主关键词吗？回答：是，这是一票否决规则
3. H2 需要多少个包含关键词？回答：2-4 个，主词≤50%
4. 我是否理解规则？回答：是，我将严格遵守

只有完成上述承诺，才能继续。

### 🚨 STEP 1: 生成标题大纲（先生成标题）

请先生成标题结构：

**H1（1个）：** 必须包含 "{primary_keyword}"
格式："{primary_keyword} - 说明" 或 "修饰 + {primary_keyword}"

**H2（2-4个）：** 至少 2 个包含关键词，主词≤50%
- 使用：主词（30%）+ 语义变体（40%）+ 相关术语（30%）

**H3（可选）：** 主词≤30%

生成标题后，立即自我验证：
- [ ] H1 是否包含 "{primary_keyword}"？
- [ ] H2 有几个包含关键词？（需要 2-4 个）
- [ ] H2 主词比例是多少？（需要 ≤50%）

验证通过才能继续 Step 2。

### STEP 2: 生成正文内容（基于已验证的标题）

（正文生成规则...）

### 第一优先级：内容质量和自然度（70%权重）

**质量标准（必须达到）：**
1. 可读性：目标受众能轻松理解
2. 信息密度：每段包含实质信息
3. 逻辑连贯：段落间自然过渡
4. 用户价值：解决用户问题

### 第二优先级：关键词策略（30%权重）

**词汇池（多样化使用）：**
- 主词：{primary} （使用频率：适度，约30%）
- 语义变体：{semanticVariants} （优先使用，约40%）
- 相关术语：{relatedTerms} （辅助使用，约30%）

**使用规则（严格遵守）：**
✅ 应该做：
- 每段最多使用主词1次
- 优先选择语义变体和相关术语
- 每3段变换一次主用词
- 确保句子自然流畅

❌ 禁止做：
- 同句子重复同一关键词
- 同段落主词超过1次
- 为插入关键词扭曲句子
- 使用"{primary}的{primary}"等堆砌模式

**反面示例（绝对不要这样写）：**
{antiPatterns}

**正面示例（应该这样写）：**
{goodExamples}

### 评估标准

生成后会自动检测：
1. **自然度检查**（必须通过）
   - 关键词间距 ≥ {spacing}字
   - 段落重复 ≤ 1次
   - 可读性 ≥ 60

2. **SEO检查**（在自然度通过后）
   - 关键词密度 {density_min}-{density_max}%
   - 词汇多样性 ≥ 70%

**重要：如果自然度检查不通过，即使密度达标也会被要求重写。**
```

---

## 实施检查清单

生成内容前：
- [ ] 已读取 keywords-{locale}.json
- [ ] 提取了所有扩展字段（semanticVariants, relatedTerms等）
- [ ] 理解了 usageGuidelines
- [ ] 查看了 antiPatterns 和 goodExamples

生成内容时：
- [ ] 使用了多样化的关键词（不仅仅是 primary）
- [ ] 每段最多主词1次
- [ ] 优先使用语义变体
- [ ] Alt 描述图片内容，非堆砌工具

生成内容后：
- [ ] 运行反堆砌检测脚本
- [ ] 所有检测项通过
- [ ] 如未通过，自动重写（最多3次）
- [ ] 记录质量评分

---

## 故障排除

### 问题1：密度不足但不想堆砌
**解决：** 使用语义变体和相关术语补充，而非重复主词

### 问题2：密度过高
**解决：**
1. 减少主词使用
2. 用语义变体替换部分主词
3. 删除不必要的重复

### 问题3：3次重写仍失败
**解决：**
1. 检查关键词数据是否合理
2. 降低密度目标
3. 人工介入（报告给用户）

---

最后更新：2026-02-01
